# 週報功能測試指南

## 啟動應用程式

### 1. 安裝相依套件（如果尚未安裝）

```powershell
# 後端
npm install

# 前端
cd client
npm install
cd ..
```

### 2. 啟動後端服務

```powershell
# 設定環境變數
$env:NODE_ENV="development"

# 啟動後端
npm run dev
```

### 3. 啟動前端服務（另開一個終端機）

```powershell
cd client
npm start
```

## 測試步驟

### 測試 1：進入週報管理頁面

1. 登入系統
2. 選擇團隊
3. 從儀表板點擊「週報管理」卡片
4. 確認可以看到週報管理頁面

**預期結果：**
- 左側顯示「歷史報表」區域（可能為空）
- 右側顯示「選擇報表」提示
- 右上角有「新增報表」按鈕

### 測試 2：建立統計報表

1. 點擊「新增報表」按鈕
2. 確認日期已預設為最近 7 天
3. 選擇「統計報表」類型（藍色圖示）
4. 點擊「產生報表」
5. 等待報表產生（約 10-30 秒）

**預期結果：**
- 顯示「產生中...」訊息
- 報表產生完成後自動顯示在右側
- 左側列表新增該報表
- 報表內容為 Markdown 格式，包含統計數據

### 測試 3：建立分析報表

1. 點擊「新增報表」
2. 修改日期範圍（選擇有數據的日期）
3. 選擇「分析報表」類型（紫色圖示）
4. 點擊「產生報表」

**預期結果：**
- 報表包含深度分析內容
- 有改善建議和問題識別

### 測試 4：建立其他類型報表

重複測試以下報表類型：
- ⚡ 燃盡圖 (burndown) - 橙色
- 🚀 生產力報告 (productivity) - 綠色
- 🎯 任務分布 (task_distribution) - 粉紅色

### 測試 5：查看歷史報表

1. 在左側列表點擊不同的報表
2. 確認右側內容正確切換
3. 檢查報表名稱、日期範圍、類型標籤

**預期結果：**
- 點擊時背景色改變（淺藍色）
- 右側內容即時更新
- 所有 Markdown 內容正確渲染

### 測試 6：重新產生報表

1. 選擇一個報表
2. 點擊「重新產生」按鈕
3. 確認對話框提示
4. 等待重新產生完成

**預期結果：**
- 顯示確認對話框
- 報表內容更新
- 顯示成功訊息

### 測試 7：刪除報表

1. 選擇一個報表
2. 點擊刪除按鈕（紅色垃圾桶圖示）
3. 確認對話框提示
4. 確認刪除

**預期結果：**
- 顯示確認對話框
- 報表從列表中移除
- 右側顯示「選擇報表」提示
- 顯示成功訊息

### 測試 8：邊界測試

#### 測試 8.1：無數據期間
1. 選擇一個沒有任何工作項目的日期範圍
2. 建立報表

**預期結果：**
- 報表仍能產生
- AI 會說明該期間無數據

#### 測試 8.2：無效日期範圍
1. 設定結束日期早於開始日期
2. 嘗試產生報表

**預期結果：**
- 顯示錯誤訊息：「結束日期不能早於開始日期」
- 無法提交

#### 測試 8.3：空白日期
1. 清空日期欄位
2. 嘗試產生報表

**預期結果：**
- HTML5 驗證阻止提交
- 或顯示「請選擇開始和結束日期」錯誤

### 測試 9：UI/UX 測試

1. **響應式設計**
   - 縮小瀏覽器視窗
   - 確認佈局正常調整

2. **載入狀態**
   - 確認載入時顯示載入中訊息
   - 產生報表時按鈕顯示「產生中...」

3. **懸停效果**
   - 滑鼠移到報表列表項目
   - 確認背景色變化

4. **顏色標識**
   - 確認不同報表類型使用不同顏色
   - 檢查圖示是否正確顯示

### 測試 10：效能測試

1. 建立多個報表（10+ 個）
2. 確認列表滾動流暢
3. 確認切換報表反應快速

## 常見問題排查

### 問題 1：報表產生失敗
**可能原因：**
- AI 服務未啟動或配置錯誤
- 資料庫連線問題

**排查步驟：**
1. 檢查後端 Console 錯誤訊息
2. 確認 `.env` 檔案中的 VLLM 設定
3. 測試 AI 服務是否正常運作

### 問題 2：看不到週報管理入口
**解決方法：**
1. 重新整理頁面
2. 確認已選擇團隊
3. 檢查瀏覽器 Console 是否有錯誤

### 問題 3：報表列表為空
**確認事項：**
1. 該團隊是否有建立過報表
2. 資料庫是否正確連線
3. 檢查 Network 面板的 API 回應

### 問題 4：Markdown 內容顯示異常
**可能原因：**
- react-markdown 套件未正確安裝

**解決方法：**
```powershell
cd client
npm install react-markdown
```

## API 測試（選用）

可以使用 Postman 或 curl 直接測試 API：

### 取得報表列表
```bash
curl -X GET http://localhost:3000/api/weekly-reports/team/1 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 產生報表
```bash
curl -X POST http://localhost:3000/api/weekly-reports/generate \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "teamId": 1,
    "startDate": "2025-11-07",
    "endDate": "2025-11-14",
    "reportType": "statistics"
  }'
```

## 測試檢查清單

- [ ] 可以進入週報管理頁面
- [ ] 可以建立統計報表
- [ ] 可以建立分析報表
- [ ] 可以建立燃盡圖
- [ ] 可以建立生產力報告
- [ ] 可以建立任務分布報表
- [ ] 可以查看歷史報表
- [ ] 可以重新產生報表
- [ ] 可以刪除報表
- [ ] 日期驗證正常運作
- [ ] 錯誤訊息正確顯示
- [ ] Markdown 內容正確渲染
- [ ] 不同報表類型顏色正確
- [ ] UI 響應式設計正常
- [ ] 載入狀態正確顯示

## 效能指標

- **報表產生時間：** 10-30 秒（取決於數據量）
- **頁面載入時間：** < 2 秒
- **報表切換時間：** < 500ms
- **列表滾動：** 流暢，無延遲

## 測試完成後

確認所有功能正常後：
1. 記錄任何發現的問題
2. 如有需要，提交 Bug Report
3. 確認實作符合 Issue #24 的所有需求

---

**測試人員：** _____________
**測試日期：** _____________
**測試結果：** ☐ 通過 ☐ 失敗（請註明原因）
